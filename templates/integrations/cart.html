<!-- Shopping Cart Integration -->
<style>
  .cart-icon {
    position: fixed;
    top: 20px;
    right: 20px;
    background: white;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    cursor: pointer;
    z-index: 999;
  }

  .cart-count {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #ef4444;
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
  }

  .cart-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .cart-modal.active {
    display: flex;
  }

  .cart-content {
    background: white;
    border-radius: 10px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    padding: 20px;
  }

  .cart-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 15px;
    border-bottom: 1px solid #e5e7eb;
  }

  .add-to-cart {
    background: #10b981;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: background 0.3s;
  }

  .add-to-cart:hover {
    background: #059669;
  }
</style>

<!-- Cart Icon -->
<div class="cart-icon" onclick="toggleCart()">
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="9" cy="21" r="1"></circle>
    <circle cx="20" cy="21" r="1"></circle>
    <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
  </svg>
  <span class="cart-count" id="cartCount">0</span>
</div>

<!-- Cart Modal -->
<div class="cart-modal" id="cartModal" onclick="closeCartIfOutside(event)">
  <div class="cart-content" onclick="event.stopPropagation()">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h2 style="margin: 0; font-size: 24px; font-weight: bold;">Troli Saya</h2>
      <button onclick="toggleCart()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
    </div>

    <div id="cartItems"></div>

    <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #e5e7eb;">
      <div style="display: flex; justify-content: space-between; font-size: 18px; font-weight: bold; margin-bottom: 15px;">
        <span>Jumlah:</span>
        <span id="cartTotal">RM 0.00</span>
      </div>
      <button onclick="checkout()" style="width: 100%; background: #3b82f6; color: white; padding: 15px; border: none; border-radius: 5px; font-size: 16px; font-weight: 600; cursor: pointer;">
        Checkout via WhatsApp
      </button>
    </div>
  </div>
</div>

<script>
  // Cart state
  let cart = JSON.parse(localStorage.getItem('cart') || '[]');

  function updateCartDisplay() {
    const cartCount = document.getElementById('cartCount');
    const cartItems = document.getElementById('cartItems');
    const cartTotal = document.getElementById('cartTotal');

    // Update count
    const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
    cartCount.textContent = totalItems;
    cartCount.style.display = totalItems > 0 ? 'flex' : 'none';

    // Update items
    if (cart.length === 0) {
      cartItems.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 40px 0;">Troli anda kosong</p>';
    } else {
      cartItems.innerHTML = cart.map((item, index) => `
        <div class="cart-item">
          <div>
            <div style="font-weight: 600;">${item.name}</div>
            <div style="color: #6b7280; font-size: 14px;">RM ${item.price.toFixed(2)} x ${item.quantity}</div>
          </div>
          <div style="display: flex; align-items: center; gap: 10px;">
            <button onclick="updateQuantity(${index}, -1)" style="width: 25px; height: 25px; border: 1px solid #d1d5db; background: white; border-radius: 3px; cursor: pointer;">-</button>
            <span style="min-width: 20px; text-align: center;">${item.quantity}</span>
            <button onclick="updateQuantity(${index}, 1)" style="width: 25px; height: 25px; border: 1px solid #d1d5db; background: white; border-radius: 3px; cursor: pointer;">+</button>
            <button onclick="removeItem(${index})" style="margin-left: 10px; color: #ef4444; background: none; border: none; cursor: pointer;">üóëÔ∏è</button>
          </div>
        </div>
      `).join('');
    }

    // Update total
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    cartTotal.textContent = `RM ${total.toFixed(2)}`;

    // Save to localStorage
    localStorage.setItem('cart', JSON.stringify(cart));
  }

  function addToCart(name, price) {
    const existingItem = cart.find(item => item.name === name);
    if (existingItem) {
      existingItem.quantity += 1;
    } else {
      cart.push({ name, price, quantity: 1 });
    }
    updateCartDisplay();
    alert(`${name} ditambah ke troli!`);
  }

  function updateQuantity(index, change) {
    cart[index].quantity += change;
    if (cart[index].quantity <= 0) {
      cart.splice(index, 1);
    }
    updateCartDisplay();
  }

  function removeItem(index) {
    cart.splice(index, 1);
    updateCartDisplay();
  }

  function toggleCart() {
    const modal = document.getElementById('cartModal');
    modal.classList.toggle('active');
  }

  function closeCartIfOutside(event) {
    if (event.target.id === 'cartModal') {
      toggleCart();
    }
  }

  function checkout() {
    if (cart.length === 0) {
      alert('Troli anda kosong!');
      return;
    }

    const items = cart.map(item => `${item.name} x${item.quantity} - RM${(item.price * item.quantity).toFixed(2)}`).join('%0A');
    const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
    const message = `Saya ingin order:%0A%0A${items}%0A%0AJumlah: RM${total.toFixed(2)}`;

    // Replace with actual WhatsApp number
    const whatsappNumber = '{{WHATSAPP_NUMBER}}';
    window.open(`https://wa.me/${whatsappNumber}?text=${message}`, '_blank');
  }

  // Initialize
  updateCartDisplay();
</script>
